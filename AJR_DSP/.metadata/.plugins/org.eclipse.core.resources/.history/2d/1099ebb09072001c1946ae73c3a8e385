/*
 * init.c
 *
 *  Created on: 2022年1月5日
 *      Author: 15755
 */
#include "user_main.h"
unsigned short Board_ID=0;
unsigned short SDRAM_READ_DATA_LEN=0;
unsigned short SDRAM_WRITE_DATA_LEN=0;
/*******************************
 * void initialization(void)
 * 设备初始化。
 ******************************/
void initialization(void)
{
    _enable_interrupt_(); /*使能中断*/
    _enable_IRQ();        /*使能中断*/
    rtiInit();            /*初始化定时器*/
    DAC5689_Init();       /*DAC5689初始化*/
    gioInit();            /*I/O 初始化*/
    muxInit();            /*引脚分配 初始化*/
    Sdram_Init();         /*SDRAM总线 初始化*/
    sciInit();            /*RS232 初始化*/
    rtiEnableNotification(rtiNOTIFICATION_COMPARE0); /*使能定时器COMPARE0 5ms*/
    rtiStartCounter(rtiCOUNTER_BLOCK0);  /*开始定时器BLOCK0计数*/
    delay_ms(100);
    canREG1->TIOC &=(~0x00000008);   /*can1_tx as i/o  to DSP_CL_N_SOV */
    canREG1->TIOC |= 0x00000004;     /*can1_tx output */
    canREG3->TIOC &=(~0x00000008);   /*can1_tx as i/o  to DSP_CL_AB_SW_SOL */
    canREG3->TIOC |= 0x00000004;     /*can1_tx output */
    SD_GPIO_Init();    /*SD卡I/O 口初始化*/
    device_status_init();
}
/**********************
 * void device_status_init(void)
 * 设备状态参数和变量初始化
 * ********************/
void device_status_init(void)
{
    unsigned short add_num=0;
    unsigned short temp=0;
    /*read Master coll*/
    MCB_Data[add_num].Addr=ADDR_INBD_LT_TEMP;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBD_RT_TEMP;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBD_LT_BPSI;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBD_RT_BPSI;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFTPPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHTPPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFTCPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHTCPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INNER_WHEEL_ABS_START_SIGNAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBOARD_SHUTOFF_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFT_INBOARD_BRAKE_CONTROL_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_INBOARD_BRAKE_CONTROL_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFTWHEELSPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHTWHEELSPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AUTO_BRAKE_SW_SIGNAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_OTHER_SW_SIGNAL;
    MCB_Data[add_num++].value=0;
    /*read Master 429*/
    MCB_Data[add_num].Addr=ADDR_HYDRAULIC_SYSTEM_PRESSURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_ACCUMULATOR_SYSTEM_PRESSURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TLA_POSITION_LEFT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TLA_POSITION_RIGHT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_MASTER_TIME;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AIRSPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_DATE_MASTER;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LG_GEARDOWN_LOCKED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_COMPUTED_WOW_DATA1;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_COMPUTED_WOW_DATA2;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AIRCRAFTACCELERATION_LEFT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AIRCRAFTACCELERATION_RIGHT;
    MCB_Data[add_num++].value=0;
    /*read Slave coll*/
     MCB_Data[add_num].Addr=ADDR_INBD_LT_TEMP | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_INBD_RT_TEMP | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_INBD_LT_BPSI | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_INBD_RT_BPSI | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFTPPEDAL | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHTPPEDAL | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFTCPEDAL | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHTCPEDAL | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_INNER_WHEEL_ABS_START_SIGNAL | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_INBOARD_SHUTOFF_VALVE_CURRENT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFT_INBOARD_BRAKE_CONTROL_VALVE_CURRENT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_INBOARD_BRAKE_CONTROL_VALVE_CURRENT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFTWHEELSPEED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHTWHEELSPEED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_AUTO_BRAKE_SW_SIGNAL | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_OTHER_SW_SIGNAL | 0x800;
     MCB_Data[add_num++].value=0;
     /*read Slave 429*/
     MCB_Data[add_num].Addr=ADDR_HYDRAULIC_SYSTEM_PRESSURE | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_ACCUMULATOR_SYSTEM_PRESSURE | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TLA_POSITION_LEFT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TLA_POSITION_RIGHT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_MASTER_TIME | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_AIRSPEED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_DATE_MASTER | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LG_GEARDOWN_LOCKED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_COMPUTED_WOW_DATA1 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_COMPUTED_WOW_DATA2 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_AIRCRAFTACCELERATION_LEFT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_AIRCRAFTACCELERATION_RIGHT | 0x800;
     MCB_Data[add_num++].value=0;
     /*write Slave coll*/
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_BCV_LT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_BCV_RT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_CV_LT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_CV_RT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_WHELL_SPEED_LT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_WHELL_SPEED_RT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_SOV | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_PLT_LT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_PLT_RT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_CPLT_LT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_TEST_DAC_CPLT_RT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_SPINUP_SIGNAL | 0x800;
     MCB_Data[add_num++].value=0;
     /*write Slave 429*/
     MCB_Data[add_num].Addr=ADDR_LEFT_WHEEL_SPEED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_WHEEL_SPEED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_CONTROL_VALVE_CURENT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_CONTROL_VALVE_CURENT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_PRESSURE | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_SHUTOFF_VALVE_CURRENT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_TEMPERATURE | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_TEMPERATURE | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_PEDAL_POSITION_PILOT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_PEDAL_POSITION_PILOT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_PEDAL_POSITION_COPILOT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_PEDAL_POSITION_COPILOT | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_WARNING | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_STATUS_1 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_STATUS_2 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_BCU_AIRCRAFT_REFERENCE_SPEED | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_1 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_2 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_3 | 0x800;
     MCB_Data[add_num++].value=0;
     MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_4 | 0x800;
     MCB_Data[add_num++].value=0;
     SDRAM_READ_DATA_LEN=add_num;
     temp=add_num;
    /*write Master coll*/
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_BCV_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_BCV_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CV_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CV_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_WHELL_SPEED_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_WHELL_SPEED_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_SOV;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_PLT_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_PLT_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CPLT_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CPLT_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_SPINUP_SIGNAL;
    MCB_Data[add_num++].value=0;
    /*write Master 429*/
    MCB_Data[add_num].Addr=ADDR_LEFT_WHEEL_SPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_WHEEL_SPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_CONTROL_VALVE_CURENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_CONTROL_VALVE_CURENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_PRESSURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_SHUTOFF_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_TEMPERATURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_TEMPERATURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_PEDAL_POSITION_PILOT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_PEDAL_POSITION_PILOT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFT_BRAKE_PEDAL_POSITION_COPILOT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_BRAKE_PEDAL_POSITION_COPILOT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_WARNING;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_STATUS_1;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_STATUS_2;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_BCU_AIRCRAFT_REFERENCE_SPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_1;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_2;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_3;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_FAILURE_WORD_4;
    MCB_Data[add_num++].value=0;
    SDRAM_WRITE_DATA_LEN=add_num-temp;
    /*MCB DSP 用于串口测试*/
    MCB_Data[add_num].Addr=ADDR_BrakePressureCommand_L;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_BrakePressureCommand_R;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_CoilEnergized;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_SOV_Open;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_SD_CARD;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_BEANCH_MODE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_DSP_MODE;
    MCB_Data[add_num++].value=0;
}


/**********************
 * void SD_GPIO_Init(void)
 * SD卡的I/O口初始化
 * ********************/
void SD_GPIO_Init(void)
{
    spiREG3->PC0 &=(~0x00000fff);    /*mbspi cs ENA CLK SIMO SOMI as i/o  to SCLK CS MOSI MISO     0--GPIO*/
    spiREG3->PC1 |=0x00000806;       /*mbspi_clkx output     0--INPUT  1--OUTPUT*/
    spiREG3->PC1 &=(~0x00000100);       /*mbspi_clkx output     0--INPUT  1--OUTPUT*/
}
