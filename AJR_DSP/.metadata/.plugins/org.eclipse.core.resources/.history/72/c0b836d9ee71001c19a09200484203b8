/*
 * init.c
 *
 *  Created on: 2022年1月5日
 *      Author: 15755
 */
#include "user_main.h"
unsigned short Board_ID=0;
/*******************************
 * void initialization(void)
 * 设备初始化。
 ******************************/
void initialization(void)
{
    _enable_interrupt_(); /*使能中断*/
    _enable_IRQ();        /*使能中断*/
    rtiInit();            /*初始化定时器*/
    DAC5689_Init();       /*DAC5689初始化*/
    gioInit();            /*I/O 初始化*/
    muxInit();            /*引脚分配 初始化*/
    Sdram_Init();         /*SDRAM总线 初始化*/
    sciInit();            /*RS232 初始化*/
    rtiEnableNotification(rtiNOTIFICATION_COMPARE0); /*使能定时器COMPARE0 5ms*/
    rtiStartCounter(rtiCOUNTER_BLOCK0);  /*开始定时器BLOCK0计数*/
    delay_ms(100);
    canREG1->TIOC &=(~0x00000008);   /*can1_tx as i/o  to DSP_CL_N_SOV */
    canREG1->TIOC |= 0x00000004;     /*can1_tx output */
    canREG3->TIOC &=(~0x00000008);   /*can1_tx as i/o  to DSP_CL_AB_SW_SOL */
    canREG3->TIOC |= 0x00000004;     /*can1_tx output */
    SD_GPIO_Init();    /*SD卡I/O 口初始化*/
    device_status_init();
}
/**********************
 * void device_status_init(void)
 * 设备状态参数和变量初始化
 * ********************/
void device_status_init(void)
{
    unsigned char add_num=0;
    /*read MCB coll*/
    MCB_Data[add_num].Addr=ADDR_INBD_LT_TEMP;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBD_RT_TEMP;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBD_LT_BPSI;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBD_RT_BPSI;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFTPPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHTPPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFTCPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHTCPEDAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INNER_WHEEL_ABS_START_SIGNAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_INBOARD_SHUTOFF_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFT_INBOARD_BRAKE_CONTROL_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHT_INBOARD_BRAKE_CONTROL_VALVE_CURRENT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LEFTWHEELSPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_RIGHTWHEELSPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AUTO_BRAKE_SW_SIGNAL;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_OTHER_SW_SIGNAL;
    MCB_Data[add_num++].value=0;
    /*read MCB 429*/
    MCB_Data[add_num].Addr=ADDR_HYDRAULIC_SYSTEM_PRESSURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_ACCUMULATOR_SYSTEM_PRESSURE;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TLA_POSITION_LEFT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TLA_POSITION_RIGHT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_MASTER_TIME;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AIRSPEED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_DATE_MASTER;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_LG_GEARDOWN_LOCKED;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_COMPUTED_WOW_DATA1;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_COMPUTED_WOW_DATA2;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AIRCRAFTACCELERATION_LEFT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_AIRCRAFTACCELERATION_RIGHT;
    MCB_Data[add_num++].value=0;
   /*read MCB coll*/
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_BCV_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_BCV_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CV_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CV_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_WHELL_SPEED_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_WHELL_SPEED_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_SOV;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_PLT_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_PLT_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CPLT_LT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_TEST_DAC_CPLT_RT;
    MCB_Data[add_num++].value=0;
    MCB_Data[add_num].Addr=ADDR_SPINUP_SIGNAL;
    MCB_Data[add_num++].value=0;
}


/**********************
 * void SD_GPIO_Init(void)
 * SD卡的I/O口初始化
 * ********************/
void SD_GPIO_Init(void)
{
    spiREG3->PC0 &=(~0x00000fff);    /*mbspi cs ENA CLK SIMO SOMI as i/o  to SCLK CS MOSI MISO     0--GPIO*/
    spiREG3->PC1 |=0x00000806;       /*mbspi_clkx output     0--INPUT  1--OUTPUT*/
    spiREG3->PC1 &=(~0x00000100);       /*mbspi_clkx output     0--INPUT  1--OUTPUT*/
}
